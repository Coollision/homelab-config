name: Helm Validate

on:
  pull_request:
    branches: ['**']
  push:
    branches: ['**']

jobs:
  helm-template:
    name: Validate Helm Templates
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Helm
        uses: azure/setup-helm@v4
        with:
          version: 'v3.19.5'
      
      - name: Add Traefik Helm repository
        run: |
          helm repo add traefik https://traefik.github.io/charts
          helm repo update
      
      - name: Update Helm dependencies - Internal Traefik
        run: |
          cd system/kube-system/traefik
          helm dependency update
      
      - name: Helm template - Internal Traefik
        run: |
          cd system/kube-system/traefik
          echo "=== Testing Internal Traefik (system/kube-system/traefik) ==="
          helm template traefik . --debug
      
      - name: Update Helm dependencies - External Traefik
        run: |
          cd system/kube-system/cloudflare-tunnel
          helm dependency update
      
      - name: Helm template - External Traefik
        run: |
          cd system/kube-system/cloudflare-tunnel
          echo "=== Testing External Traefik (system/kube-system/cloudflare-tunnel) ==="
          helm template traefik-external . --debug
