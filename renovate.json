{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    "helpers:pinGitHubActionDigests",
    ":timezone(Europe/Brussels)",
    ":label(dependencies)"
  ],
  "prHourlyLimit": 0,
  "rebaseWhen": "conflicted",
  "pinDigests": true,
  "helm-values": {
    "managerFilePatterns": [
      "/Chart\\.yaml$/"
    ],
    "ignorePaths": [
      "lib/**"
    ]
  },
  "kubernetes": {
    "managerFilePatterns": [
      "/\\.ya?ml$/"
    ],
    "ignorePaths": [
      "lib/**"
    ]
  },
  "separateMinorPatch": true,
  "separateMajorMinor": true,
  "schedule": [
    "after 7pm and before 10pm"
  ],
  "packageRules": [
    {
      "description": "Automerge patch updates for infrastructure stability",
      "matchUpdateTypes": [
        "patch"
      ],
      "automerge": true,
      "platformAutomerge": true,
      "automergeSchedule": [
        "after 1am and before 4am"
      ],
      "ignoreTests": true
    },
    {
      "description": "Group system infrastructure updates",
      "matchFileNames": [
        "system/**"
      ],
      "groupName": "system infrastructure",
      "addLabels": [
        "system",
        "infrastructure"
      ],
      "minimumReleaseAge": "3 days"
    },
    {
      "description": "Group workload application updates",
      "matchFileNames": [
        "workload/**"
      ],
      "groupName": "workload applications",
      "addLabels": [
        "workload",
        "applications"
      ],
      "minimumReleaseAge": "1 day"
    },
    {
      "description": "Group ArgoCD configuration updates",
      "matchFileNames": [
        "argocd/**"
      ],
      "groupName": "argocd configuration",
      "addLabels": [
        "argocd",
        "gitops"
      ],
      "minimumReleaseAge": "3 days"
    },
    {
      "description": "Group Prometheus/Grafana monitoring stack updates",
      "matchSourceUrls": [
        "https://prometheus-community.github.io/helm-charts",
        "https://grafana.github.io/helm-charts"
      ],
      "groupName": "monitoring stack",
      "addLabels": [
        "monitoring"
      ],
      "minimumReleaseAge": "5 days"
    },
    {
      "description": "Critical security updates - no stability days",
      "matchUpdateTypes": [
        "patch"
      ],
      "matchCurrentVersion": "!/.*security.*/",
      "minimumReleaseAge": null
    }
  ]
}
